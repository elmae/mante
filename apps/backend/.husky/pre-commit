#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo 'ğŸ—ï¸ Running pre-commit checks...'

# Check TypeScript types
echo 'ğŸ‘€ Checking types...'
npm run typecheck || {
    echo 'âŒ Type check failed. Please fix TypeScript errors before committing.'
    exit 1
}

# Run lint-staged
echo 'ğŸ§¹ Running lint-staged...'
npx lint-staged || {
    echo 'âŒ Lint-staged failed. Please fix code style issues before committing.'
    exit 1
}

# Run tests related to staged files
echo 'ğŸ§ª Running tests for changed files...'
files=$(git diff --cached --name-only --diff-filter=ACMR "*.ts" "*.tsx" | tr '\n' ' ')
if [ -n "$files" ]; then
    npm test -- --findRelatedTests $files --passWithNoTests || {
        echo 'âŒ Tests failed. Please fix failing tests before committing.'
        exit 1
    }
fi

echo 'âœ… Pre-commit checks passed!'